# 预测功能测试方案

## 测试目标

验证数据工厂系统生成的数据能够支持工业大模型的预测功能。预测功能需要根据10000点历史数据，预测未来10分钟（120点）的关键数据走势。

## 测试原则

1. **从简单到复杂**：逐步验证不同复杂度的数据关系
2. **覆盖所有能力模板**：确保每种数据关系类型都能正确生成
3. **验证数据特征**：确保未来120点数据存在可预测的特征变化
4. **数据完整性**：确保历史数据和未来数据的连续性

## 测试环境

- Python 3.13
- 数据点数：10000点历史 + 120点未来 = 10120点
- 时间间隔：5秒
- 测试数据输出目录：`test_output/`

---

## 测试项1：单一正弦波基础测试

### 测试目的
验证最基本的单一参数预测场景，确保系统能够生成标准的正弦波数据。

### ⚠️ 测试限制
**注意**：预测功能要求输入数据和目标数据不能重复，因此单参数场景不适用于预测测试。本测试项主要用于验证数据生成功能，不适用于预测功能验证。

### 测试配置
配置文件：`config/test_case_01_single_sine.yaml`

### 测试数据特征
- 1个参数：F.sine
- 振幅：100.0
- 周期：3600秒（1小时）
- 无噪声

### 预期结果
1. 生成10120点数据（10000历史 + 120未来）
2. 数据呈现标准正弦波形态
3. 历史数据和未来数据连续，无明显跳变
4. 未来120点数据能够延续历史数据的周期性特征

### 验证方法
1. 检查生成的数据文件是否包含timeStamp和F.sine两列
2. 可视化查看数据曲线，确认正弦波形态
3. 检查历史数据和未来数据的连接点是否平滑
4. 计算周期，验证未来数据是否延续历史周期

### 实际测试结果
- **测试状态**：不适用于预测功能测试
- **原因**：预测的输入数据和目标数据不能重复，单参数无法测试
- **建议**：跳过此测试项，从测试项2（多参数测试）开始

---

## 测试项2：多参数独立正弦波测试

### 测试目的
验证多个独立参数同时预测的场景，测试系统处理多参数的能力。

### 测试配置
配置文件：`config/test_case_02_multi_sine.yaml`

### 测试数据特征
- 2个参数：F.sine1, F.sine2
- F.sine1：振幅100，周期1小时
- F.sine2：振幅50，周期2小时
- 两个参数相互独立，无关联关系

### 预期结果
1. 生成包含3列的数据（timeStamp, F.sine1, F.sine2）
2. 两个正弦波各自保持独立的周期性
3. 未来120点数据能够同时延续两个参数的周期性特征
4. 两个参数之间无异常关联

### 验证方法
1. 检查数据列数是否为3列
2. 分别可视化两个参数，确认各自的周期性
3. 检查未来数据是否同时延续两个参数的周期
4. 验证两个参数之间的相关性（应该很低）

### 实际测试结果
- **测试状态**：✅ 测试成功
- **结论**：多参数独立正弦波测试成功，预测功能能够处理多个独立参数的场景

---

## 测试项2b：随机数输入+正弦目标测试

### 测试目的
测试用随机数作为输入，正弦作为目标，是否能预测正弦的未来。这是一个挑战性测试，验证预测模型是否能从无规律的输入中学习到目标数据的规律。

### 测试配置
配置文件：`config/test_case_02b_random_sine.yaml`

### 测试数据特征
- 输入参数：F.random（-100到100的均匀随机数）
- 目标参数：F.sine（正弦波，振幅100，周期1小时）
- 测试场景：用无规律的随机数预测有规律的正弦波

### 预期结果
1. 生成包含3列的数据（timeStamp, F.random, F.sine）
2. F.random呈现随机分布（-100到100均匀分布）
3. F.sine呈现标准正弦波形态
4. 两个参数之间无关联（随机数和正弦波独立）
5. 验证预测模型是否能从随机输入中学习到正弦波的规律

### 验证方法
1. 检查数据列数是否为3列
2. 可视化F.random，确认随机分布特征
3. 可视化F.sine，确认正弦波形态
4. 计算两个参数之间的相关性（应该很低，因为随机数和正弦波无关联）
5. 使用预测模型测试，验证是否能从随机输入预测正弦波未来
6. 分析预测结果，评估模型学习能力

### 测试意义
- 测试预测模型的泛化能力
- 验证模型是否能从无关联的输入中学习目标规律
- 评估模型对时间序列规律的识别能力

---

## 测试项3：滞后跟随关系测试

### 测试目的
验证滞后跟随关系的数据生成，测试一个参数跟随另一个参数变化的场景。使用随机数作为源数据，避免周期性规律影响预测结果。

### 测试配置
配置文件：`config/test_case_03_lag_follow.yaml`

### 测试数据特征
- 2个参数：F.value1（源数据），F.value2（跟随数据）
- F.value1：0~100的均匀随机数
- F.value2：滞后跟随F.value1，滞后5分钟（300秒），敏感度1.0

### 预期结果
1. F.value1呈现随机分布（0~100）
2. F.value2跟随F.value1变化，但存在5分钟（300秒）滞后
3. F.value2的值与F.value1的值相同（敏感度1.0，完全跟随）
4. 未来120点数据能够延续滞后跟随关系
5. 预测模型需要识别滞后关系才能准确预测

### 验证方法
1. 可视化两个参数，确认滞后关系
2. 计算滞后时间，验证是否为300秒（5分钟）
3. 检查F.value2是否完全跟随F.value1（敏感度1.0）
4. 检查未来数据是否保持滞后跟随关系
5. 验证预测模型是否能识别并预测滞后跟随关系

---

## 测试项3b：滞后跟随关系测试（约束随机游走版本）

### 测试目的
验证滞后跟随关系的数据生成，使用约束随机游走作为源数据。相比完全随机数，约束随机游走具有连续性，更接近真实场景。

### 测试配置
配置文件：`config/test_case_03b_lag_follow_constrained.yaml`

### 测试数据特征
- 2个参数：F.value1（源数据），F.value2（跟随数据）
- F.value1：约束随机游走，每次变化量限制在[-3, 3]，值范围[0, 100]
- F.value2：滞后跟随F.value1，滞后5分钟（300秒），敏感度1.0

### 预期结果
1. F.value1呈现平滑的随机游走形态，变化连续
2. F.value2跟随F.value1变化，但存在5分钟（300秒）滞后
3. F.value2的值与F.value1的值相同（敏感度1.0，完全跟随）
4. 未来120点数据能够延续滞后跟随关系
5. 预测模型需要识别滞后关系才能准确预测

### 验证方法
1. 可视化两个参数，确认滞后关系
2. 检查F.value1的变化是否平滑（每次变化不超过3）
3. 检查F.value1的值是否在[0, 100]范围内
4. 计算滞后时间，验证是否为300秒（5分钟）
5. 检查F.value2是否完全跟随F.value1（敏感度1.0）
6. 检查未来数据是否保持滞后跟随关系
7. 验证预测模型是否能识别并预测滞后跟随关系

### 与测试项3的区别
- **测试项3**：使用完全随机数（0~100均匀分布）
- **测试项3b**：使用约束随机游走（每次变化[-3, 3]，值范围[0, 100]）
- **优势**：约束随机游走具有连续性，更接近真实工业场景的数据变化特征

---

## 测试项4：滞后多项式/非线性关系测试

### 测试目的
验证多个参数之间的滞后多项式关系和非线性关系，测试复杂的数据关联。

**说明**：单纯的当下多项式关系对预测未来作用不大。必须是多项式的数据源本身就具有一定的规则性，或者目的参数与输入参数的多项式关系存在滞后。

### 测试项4a：滞后多项式关系测试

#### 测试配置
配置文件：`config/test_case_04a_polynomial_lag.yaml`

#### 测试数据特征
- 2个源参数：F.value1, F.value2（都是约束随机游走）
- 1个组合参数：F.value3
- F.value1：约束随机游走，每次变化[-3, 3]，值范围[0, 100]
- F.value2：约束随机游走，每次变化[-3, 3]，值范围[0, 100]
- F.value3：滞后多项式关系，滞后5分钟（300秒 = 60个点）
- **关系式**：value3[index] = value1[index - 60] + 3*value2[index - 60]

#### 预期结果
1. 生成4列数据（timeStamp + 3个参数）
2. F.value1和F.value2呈现平滑的随机游走形态
3. F.value3的值符合滞后多项式关系公式
4. F.value3滞后F.value1和F.value2共5分钟
5. 未来120点数据能够延续滞后多项式关系

#### 验证方法
1. 检查数据列数是否为4列
2. 验证F.value3的值是否符合滞后多项式公式
3. 检查滞后时间是否为5分钟（60个点）
4. 验证预测模型是否能识别滞后多项式关系
5. 检查未来数据是否保持滞后多项式关系

---

### 测试项4b：滞后非线性关系测试

#### 测试配置
配置文件：`config/test_case_04b_nonlinear_lag.yaml`

#### 测试数据特征
- 2个源参数：F.value1, F.value2（都是约束随机游走）
- 1个组合参数：F.value3
- F.value1：约束随机游走，每次变化[-3, 3]，值范围[0, 100]
- F.value2：约束随机游走，每次变化[-3, 3]，值范围[0, 100]
- F.value3：滞后非线性关系，滞后5分钟（300秒 = 60个点）
- **关系式**：value3[index] = sqrt(value1[index - 60] * value2[index - 60])

#### 预期结果
1. 生成4列数据（timeStamp + 3个参数）
2. F.value1和F.value2呈现平滑的随机游走形态
3. F.value3的值符合滞后非线性关系公式
4. F.value3滞后F.value1和F.value2共5分钟
5. F.value3的值等于sqrt(value1 * value2)（滞后60个点）
6. 未来120点数据能够延续滞后非线性关系

#### 验证方法
1. 检查数据列数是否为4列
2. 验证F.value3的值是否符合滞后非线性公式
3. 检查滞后时间是否为5分钟（60个点）
4. 验证预测模型是否能识别滞后非线性关系
5. 检查未来数据是否保持滞后非线性关系
6. 验证sqrt函数的计算结果是否正确

---

### 测试项4c：多项式关系测试（正弦波源数据，无滞后）

#### 测试配置
配置文件：`config/test_case_04c_polynomial_sine.yaml`

#### 测试数据特征
- 2个源参数：F.value1, F.value2（都是正弦波）
- 1个组合参数：F.value3
- F.value1：正弦波，振幅100，周期3600秒（1小时）
- F.value2：正弦波，振幅50，周期1900秒
- F.value3：多项式关系，无滞后
- **关系式**：value3[index] = value1[index] + value2[index]

#### 预期结果
1. 生成4列数据（timeStamp + 3个参数）
2. F.value1和F.value2呈现正弦波形态
3. F.value3的值等于F.value1和F.value2的即时和
4. F.value3呈现复合正弦波形态（两个正弦波的叠加）
5. 未来120点数据能够延续多项式关系

#### 验证方法
1. 检查数据列数是否为4列
2. 验证F.value3的值是否符合多项式公式（即时）
3. 可视化F.value1、F.value2和F.value3，确认叠加关系
4. 验证预测模型是否能识别多项式关系
5. 检查未来数据是否保持多项式关系

---

### 测试项4d：滞后多项式关系测试（正弦波源数据，有滞后）

#### 测试配置
配置文件：`config/test_case_04d_polynomial_sine_lag.yaml`

#### 测试数据特征
- 2个源参数：F.value1, F.value2（都是正弦波）
- 1个组合参数：F.value3
- F.value1：正弦波，振幅100，周期3600秒（1小时）
- F.value2：正弦波，振幅50，周期1900秒
- F.value3：滞后多项式关系，滞后5分钟（300秒 = 60个点）
- **关系式**：value3[index] = value1[index - 60] + value2[index - 60]

#### 预期结果
1. 生成4列数据（timeStamp + 3个参数）
2. F.value1和F.value2呈现正弦波形态
3. F.value3的值等于F.value1和F.value2的滞后和
4. F.value3滞后F.value1和F.value2共5分钟
5. F.value3呈现复合正弦波形态（两个正弦波的滞后叠加）
6. 未来120点数据能够延续滞后多项式关系

#### 验证方法
1. 检查数据列数是否为4列
2. 验证F.value3的值是否符合滞后多项式公式
3. 检查滞后时间是否为5分钟（60个点）
4. 可视化F.value1、F.value2和F.value3，确认滞后叠加关系
5. 验证预测模型是否能识别滞后多项式关系
6. 检查未来数据是否保持滞后多项式关系

---

## 测试项5：组合关系测试

### 测试目的
验证组合能力模板，测试多种数据关系的组合使用。

### 测试配置
配置文件：`config/test_case_05_composite.yaml`

### 测试数据特征
- 多个基础参数：F.light（光照），F.power（功率）
- 滞后跟随参数：F.temperature（温度跟随功率）
- 多项式组合参数：F.combined（组合多个参数）

### 预期结果
1. 生成包含多个参数的数据
2. 各参数之间的关系正确
3. 未来120点数据能够延续所有关系
4. 数据特征变化明显，适合预测

### 验证方法
1. 检查所有参数是否都生成
2. 验证各参数之间的关系是否正确
3. 检查未来数据的特征变化
4. 确认数据复杂度适合预测任务

---

## 测试项6：噪声影响测试

### 测试目的
验证噪声对数据生成和预测的影响，测试系统在噪声环境下的表现。

### 测试配置
配置文件：`config/test_case_06_noise.yaml`

### 测试数据特征
- 2个参数：F.clean（无噪声），F.noisy（有噪声）
- F.clean：正弦波，噪声水平0%
- F.noisy：正弦波，噪声水平10%

### 预期结果
1. F.clean呈现平滑的正弦波
2. F.noisy在正弦波基础上叠加噪声
3. 噪声不影响数据的整体趋势
4. 未来数据能够延续趋势（噪声随机）

### 验证方法
1. 可视化对比两个参数，确认噪声差异
2. 计算噪声水平，验证是否符合配置
3. 检查未来数据是否保持趋势
4. 验证噪声不影响周期性特征

---

## 测试项7：相位差测试

### 测试目的
验证不同相位参数之间的关系，测试相位差对预测的影响。

### 测试配置
配置文件：`config/test_case_07_phase.yaml`

### 测试数据特征
- 2个参数：F.sine1, F.sine2
- 相同振幅和周期，但相位不同
- F.sine1：相位0度
- F.sine2：相位90度（周期/4）

### 预期结果
1. 两个正弦波周期相同但相位不同
2. F.sine2比F.sine1滞后90度
3. 未来数据能够延续相位差关系
4. 相位差在预测中能够体现

### 验证方法
1. 可视化两个参数，确认相位差
2. 计算相位差，验证是否为90度
3. 检查未来数据是否保持相位差
4. 验证相位关系在预测中的重要性

---

## 测试项8：复杂组合场景测试

### 测试目的
验证最复杂的组合场景，包含时间规律、滞后跟随、多项式关系的组合。

### 测试配置
配置文件：`config/test_case_08_complex.yaml`

### 测试数据特征
- 多个基础参数：光照、功率、温度等
- 多种关系：时间规律、滞后跟随、多项式组合
- 包含噪声和相位差

### 预期结果
1. 生成包含多个参数的数据
2. 所有关系正确实现
3. 数据复杂度高，适合真实预测场景
4. 未来数据特征变化明显

### 验证方法
1. 检查所有参数和关系
2. 验证数据复杂度
3. 检查未来数据的特征变化
4. 确认适合作为预测测试数据

---

## 测试执行步骤

1. **准备阶段**
   - 确保所有YAML配置文件已创建
   - 创建测试输出目录：`test_output/`

2. **逐项测试**
   - 按照测试项1-8的顺序执行
   - 每个测试项执行以下步骤：
     a. 运行数据生成：`python main.py`（修改config_path为对应测试配置）
     b. 检查生成的数据文件
     c. 使用可视化工具查看数据
     d. 验证预期结果
     e. 记录测试结果

3. **结果记录**
   - 记录每个测试项的通过/失败状态
   - 记录发现的问题
   - 记录数据特征验证结果

4. **问题处理**
   - 对于失败的测试项，分析原因
   - 修复问题后重新测试
   - 更新测试配置（如需要）

---

## 测试验收标准

所有测试项满足以下条件视为通过：

1. ✅ 数据文件成功生成（历史数据 + 完整数据）
2. ✅ 数据点数正确（10000历史 + 120未来）
3. ✅ 数据列数符合配置
4. ✅ 数据关系正确实现
5. ✅ 历史数据和未来数据连续
6. ✅ 未来数据能够延续历史数据的特征
7. ✅ 数据特征变化明显，适合预测任务

---

## 测试数据文件清单

| 测试项 | 配置文件 | 输出文件前缀 | 参数数量 |
|--------|----------|-------------|----------|
| 测试项1 | test_case_01_single_sine.yaml | test_01_single_sine | 1 |
| 测试项2 | test_case_02_multi_sine.yaml | test_02_multi_sine | 2 |
| 测试项3 | test_case_03_lag_follow.yaml | test_03_lag_follow | 2 |
| 测试项4 | test_case_04_polynomial.yaml | test_04_polynomial | 4 |
| 测试项5 | test_case_05_composite.yaml | test_05_composite | 4+ |
| 测试项6 | test_case_06_noise.yaml | test_06_noise | 2 |
| 测试项7 | test_case_07_phase.yaml | test_07_phase | 2 |
| 测试项8 | test_case_08_complex.yaml | test_08_complex | 5+ |

---

## 注意事项

1. 每个测试项应独立执行，避免相互影响
2. 测试前确保输出目录为空或使用新的时间戳
3. 可视化工具用于验证数据特征，建议每个测试项都进行可视化检查
4. 测试数据可用于后续的预测模型训练和验证
5. 如发现配置问题，及时更新对应的YAML文件

